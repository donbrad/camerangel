<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
    <link href="styles/main.css" rel="stylesheet" />

    <script src="cordova.js"></script>
    <script src="kendo/js/jquery.min.js"></script>
    <script src="kendo/js/kendo.mobile.min.js"></script>

    <script src="scripts/app.js"></script>
    <script src="scripts/parse.js"></script>

    <script>
   
    function togglePrivate (e) {
        e.preventDefault();
        var privateMode = !APP.models.home.privateMode;
        APP.models.home.privateMode = privateMode;
        if (privateMode) {
            $('.privateModeButton').text('Private');
            $('.user-content').removeClass('publicMode');
            $('.user-content').addClass('privateMode');

        } else {
            $('.privateModeButton').text('Public');
            $('.user-content').addClass('publicMode');
            $('.user-content').removeClass('privateMode');
        }
    }
        
   

    function beforeShowFilter() {

        if (APP.models.home.privateMode) {
            $('.privateModeButton').text('Private');
            $('.user-content').removeClass('publicMode');
            $('.user-content').addClass('privateMode');

        } else {
            $('.privateModeButton').text('Public');
            $('.user-content').addClass('publicMode');
            $('.user-content').removeClass('privateMode');
        }   
        
        $(".user-content").kendoTouch({
            touchstart: function(e) {
                e.preventDefault();
                if (!APP.models.home.privateMode)
                    return;
                 $('.user-content').addClass('publicMode');
                 $('.user-content').removeClass('privateMode');
            },
            dragend: function(e) {
                e.preventDefault();
                 if (!APP.models.home.privateMode)
                    return;
                 $('.user-content').removeClass('publicMode');
                 $('.user-content').addClass('privateMode');
            },
        }); 
    }
        
    function homeBeforeShow () {
        
        if (APP.models.profile.currentUser) {
            // Have current user - redirect to user view
            
            APP.models.profile.username =  APP.models.profile.currentUser.attributes.username;
            APP.models.profile.email =  APP.models.profile.currentUser.attributes.email;
            APP.models.profile.phone =  APP.models.profile.currentUser.attributes.phone;
             APP.models.profile.alias =  APP.models.profile.currentUser.attributes.alias;
            APP.kendo.navigate('#home');
            
        } else {
            // No current user -redirect to no user view
           APP.kendo.navigate('#nouser');
        }
    } 
        
    function homeSignout () {
       
        Parse.User.logOut();
        APP.models.profile.currentUser = '';
        APP.models.profile.username =  '';
        APP.models.profile.email =  '';
        APP.models.profile.phone =  '';
        APP.models.profile.alias =  '';
        APP.kendo.navigate('#newuserhome');
    }
        
    function homeSignin () {
       Parse.User.logIn($('#home-signin-username').val(), $('#home-signin-password').val(), {
            success: function(user) {
            // Do stuff after successful login.
                closeModalViewLogin();
                APP.models.profile.currentUser = user;
                APP.models.profile.username =  APP.models.profile.currentUser.attributes.username;
                APP.models.profile.email =  APP.models.profile.currentUser.attributes.email;
                APP.models.profile.phone =  APP.models.profile.currentUser.attributes.phone;
                 APP.models.profile.alias =  APP.models.profile.currentUser.attributes.alias;
                APP.kendo.navigate('#home');
            },
            error: function(user, error) {
            // The login failed. Check error to see why.
                 alert("Error: " + error.code + " " + error.message);
            }
        });
    }
   
    function closeModalViewLogin() {
        $("#modalview-login").kendoMobileModalView("close");
    }
        
    function closeModalViewSignup() {
        $("#modalview-signup").kendoMobileModalView("close");
    }
        
    function closeModalViewRecoverPassword() {
        $("#modalview-recoverPassword").kendoMobileModalView("close");
    }
        
    function homeCreateAccount() {
        var user = new Parse.User();
        var username = $('#home-signup-username').val();
        var password = $('#home-signup-password').val();
        var phone = $('#home-signup-phone').val();
        var alias = $('#home-signup-alias').val();
        
        APP.models.profile.username = username;
        APP.models.profile.email = username;
        APP.models.profile.phone = phone;
        APP.models.profile.alias = alias;
        
        //Todo: add validation for user entry and prior to parse call
        user.set("username", username);
        user.set("password", password);
        user.set("email", username);
        user.set("phone", phone);
        user.set("alias", alias);

        user.signUp(null, {
            success: function(user) {
                // Hooray! Let them use the app now.
               closeModalViewSignup();
               haveActiveUser();
            },
            
            error: function(user, error) {
            // Show the error message somewhere and let the user try again.
            alert("Error: " + error.code + " " + error.message);
            }
        });
    }
        
    function introChanging () {
        $('.intro-photo-block').removeClass('animated fadeIn');
        $('.intro-photo-block').addClass('hidden');
    }

    function introChanged () {
        $('.intro-photo-block').removeClass('hidden');
        $('.intro-photo-block').addClass('animated fadeIn');
    }
</script>

</head>
<body id="body">
 
<div data-role="layout" data-id="main" style="display:none;">
    <div data-role="header">
        <div data-role="navbar">
            <span data-role="view-title"></span>
            <a data-role="button" href="#appDrawer" data-rel="drawer" data-align="left" data-icon="drawer-button"></a>
            <a data-role="button" class="privateModeButton" data-click="togglePrivate" data-align="right" >Public</a>
        </div>
    </div>

    <div data-role="content" class='view-content'>
    <!-- application views will be rendered here -->
    </div>

</div>
    
<div data-role="layout" data-id="newuser" style="display:none">
    <div data-role="header">
       
    </div>

    <div data-role="content" class='view-content'>
    <!-- application views will be rendered here -->
    </div>

</div>

  <!-- application drawer and contents -->
 <div data-role="drawer" id="appDrawer" style="width: 180px" data-title="Main Menu" style="display:none;">
    <div data-role="header">
      <div data-role="navbar">
        <span data-role="view-title"></span>
      </div>
    </div>
    <ul data-role="listview">
      <li>
        <a href="views/home.html">Home</a>
      </li>
      <li>
        <a href="views/profile.html">Profile</a>
      </li>
      <li>
        <a href="views/channels.html">Channels</a>
      </li>
          <li>
        <a href="views/gallery.html">Gallery</a>
      </li>
      <li>
        <a href="views/contacts.html">Contacts</a>
      </li>
    </ul>
  </div>       
    
<!-- home - for signed in users -->
<div data-role="view" data-title="ghostgrams" id="home" data-layout="main" data-model="APP.models.home" class='appearance' style='display:none;'>
    <div class="user-content">
        <div >
           <div  style='padding-top: 24px; padding-bottom: 28px; font-size: 24px; text-align: center; color: #aeaeae'> Personal, private, secure</div>
       </div>
        
        <div id="home-list">
                 
        </div>

        <div id="home-footer">
             <div> 
                <a style="width:98%;" class="button ghostButton"  data-click="homeSignout" data-role="button">Sign Out</a>
            </div>

        </div>
    </div>
</div>
    
<!-- home - for new users -->
 <div data-role="view" data-title="ghostgrams" id='newuserhome' data-layout="newuser" data-model="APP.models.home" class='appearance' style='display:none;'>
   <div >
       <div  style='padding-top: 24px; padding-bottom: 28px; font-size: 24px; text-align: center; color: #aeaeae'>  Personal, private, secure</div>
   </div>
    

    <div id="home-signin">
        <div style='padding-top: 12px; padding-left:12px; padding-bottom: 12px;  text-align: center;'> <span class="ghostTextLarge"> Get your ghost on!!!</span></div>

        <div> 
            <a style="width:98%;" class="button ghostButton"  data-rel="modalview" href="#modalview-login" data-role="button">Sign In</a>
        </div>

        <div style="padding-top: 8px;">
            <a style="width:98%; font-size: 0.9em;" class="button ghostButton" data-rel="modalview" href="#modalview-recoverPassword" data-role="button">Forgot your Password?</a>
        </div>
        <div style='clear:both; padding-top: 28px; padding-left:12px;text-align:center;'>
            <span class="ghostText" >Don't have an Account? </br> Sign Up Now!</span>
        </div>
        <div style='clear:both; padding-top: 12px;' >
            <a style="width:98%;" class="button ghostButton" id="home-signup" data-role="button" data-rel="modalview" href="#modalview-signup" >Sign Up</a>
        </div>
         
    </div>
</div>



<div data-role="modalview" id="modalview-login" style="width: 90%; display: none;" class="appearance">
    <div data-role="header">
        <div data-role="navbar">
            <span>Sign In</span>
            
        </div>
    </div>

     <form>
        <ul data-role="listview" data-style="inset">
            <li>
                <label>Username
                    <input type="text" id="home-signin-username" value="" />
                </label>
            </li>
            <li>
                <label>Password
                <input type="password" id="home-signin-password" value="" />
                </label>
            </li>
        </ul>
    </form> 
    <div data-role="footer">
        <div data-role="navbar">
            <a data-click="closeModalViewLogin" data-role="button" data-align="left">Cancel</a>
            <a data-click="homeSignin" id="modalview-login-button" type="button" data-role="button" data-align="right">Sign In</a>
        </div>
    </div>
</div>
    
<div data-role="modalview" id="modalview-signup" style="width: 90%; display: none;" class="appearance" >
    <div data-role="header">
        <div data-role="navbar">
            <span>Create Account</span>
        </div>
    </div>
   <form>
        <ul data-role="listview" data-style="inset">
            <li>
                <label>Username (Email address)
                    <input type="email" id="home-signup-username" value="" />
                </label>
            </li>
             <li>
                <label>Alias (How other users will see you)
                    <input type="text" id="home-signup-alias" value="" />
                </label>
            </li>
            <li>
                <label>Password
                <input type="password" id="home-signup-password" value="" />
                </label>
            </li>
             <li>
                <label>Mobile Phone
                <input type="tel" id="home-signup-phone" value="" />
                </label>
            </li>
        </ul>
    </form> 
    <div data-role="footer">
        <div data-role="navbar">
            <a data-click="closeModalViewSignup" data-role="button" data-align="left">Cancel</a>
            <a data-click="homeCreateAccount" id="home-createAccount" type="button" data-role="button" data-align="right">Sign Up</a>
    </div>
</div>
<div data-role="modalview" id="modalview-recoverPassword" style="width: 90%; display:none;" class="appearance">
    <div data-role="header">
        <div data-role="navbar">
            <span>Recover Password</span>
        </div>
    </div>

     <form>
        <ul data-role="listview" data-style="inset">
            <li>
                <label>Send Recover instructions to: 
                    <input type="text" id="home-recoverPassword-email" value="" />
                </label>
            </li>
        </ul>
    </form> 
    <div data-role="footer">
        <div data-role="navbar">
            <a data-click="closeModalViewRecoverPassword" data-role="button" data-align="left">Cancel</a>
            <a data-click="homeRecoverPassword" id="modalview-recoverPassword-button" type="button" data-role="button" data-align="right">Recover Password</a>
        </div>
    </div>
</div>
</body>
</html>
