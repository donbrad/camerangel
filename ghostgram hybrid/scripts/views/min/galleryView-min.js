"use strict";var galleryView={_returnView:null,_mode:"gallery",_pickerMode:!1,_currentPhoto:{},_currentPhotoId:null,_currentPhotoUrl:null,_previewSize:"33%",_viewInitialized:!1,onInit:function(o){_preventDefault(o),archiveView.init();var e=function(){$("#search-archives").height(getSentinelHeight())},t=$(window).width()/4;photoModel.rotationAngle=0,photoModel.optionsHidden=!0,photoModel.optionsShown=!0;var i=o.view.scroller},onShow:function(o){_preventDefault(o),galleryView._viewInitialized||(galleryView._viewInitialized=!0,$("#gallery .gg_mainSearchInput").on("input",function(){var o=this.value;o.length>0?(photoModel.photosDS.filter({logic:"or",filters:[{field:"name",operator:"contains",value:o},{field:"description",operator:"contains",value:o},{field:"tagsString",operator:"contains",value:o},{field:"dateString",operator:"contains",value:o},{field:"addressString",operator:"contains",value:o}]}),$("#gallery .enterSearch").removeClass("hidden")):($("#gallery .enterSearch").addClass("hidden"),photoModel.photosDS.filter([]))}),$("#gallery .enterSearch").on("click",function(){$("#gallery .gg_mainSearchInput").val(""),photoModel.photosDS.filter([]),$(this).addClass("hidden")})),$("#gallery .gg_mainSearchInput").attr("placeholder","Search memories..."),void 0!==o.view.params.mode&&"picker"===o.view.params.mode?(galleryView._pickerMode=!0,mobileNotify("Please select an image to send...")):galleryView._pickerMode=!1,void 0!==o.view.params.returnview&&(galleryView._returnView=o.view.params.returnview),photoModel.rotationAngle=0;var e=$("#gallery > div.footerMenu.km-footer > a"),t=$("#gallery > div.footerMenu.km-footer > a > span > img"),i=$("#gallery > div.footerMenu.km-footer > a > span > p"),a=o.view.scroller;e.removeAttr("href").on("click",function(o){galleryView.galleryActionView(o)}),$("#gallery-listview li").css("width",photoModel.previewSize),$("#gallery-listview li").css("padding-bottom",photoModel.previewSize);var l=$("#galleryMenuSelect").data("kendoMobileButtonGroup").current().index();0===l&&e.css("display","inline-block"),"33%"===galleryView._previewSize?(i.text("List view"),t.attr("src","images/gallery-list.svg")):(i.text("Grid view"),t.attr("src","images/gallery-grid.svg")),i.addClass("actionBtn-text-light"),ux.showActionBtnText("#gallery","3.5rem");var r=0;$("#filterCount").text(r),r>1?$("#filterText").text("Filters"):0===r?($("#filterCount").text(""),$("#filterText").text("Filter")):$("#filterText").text("Filter")},onHide:function(o){var e=$("#gallery > div.footerMenu.km-footer > a"),t=$("div.footerMenu.km-footer > a > span > img"),i=$("div.footerMenu.km-footer > a > span > p");e.css("display","none"),t.attr("src","images/nav-add-white.svg"),i.removeClass("actionBtn-text-light").text(""),ux.hideSearch()},galleryActionView:function(o){_preventDefault(o);var e=$("#gallery > div.footerMenu.km-footer > a > span > p");"33%"===galleryView._previewSize?(ux.changeActionBtnImg("#gallery","gallery-grid"),e.text("Grid view"),galleryView._previewSize="100%"):(ux.changeActionBtnImg("#gallery","gallery-list"),e.text("List view"),galleryView._previewSize="33%"),$("#gallery-listview li").css("width",galleryView._previewSize),$("#gallery-listview li").css("padding-bottom",galleryView._previewSize)},selectCategory:function(o){_preventDefault(o);var e=this.current().index();switch(e){case 0:ux.showActionBtn(!0,"#gallery"),$("#archive-listview").addClass("hidden"),$("#gallery-listview").removeClass("hidden");break;case 1:ux.showActionBtn(!1,"#gallery"),$("#archive-listview").removeClass("hidden"),$("#gallery-listview").addClass("hidden")}$("#gallerySearch").attr("placeholder","Search All")},galleryClick:function(o){_preventDefault(o);var e=o.dataItem,t=o.dataItem.photoId,i=o.dataItem.imageUrl;modalPhotoView.openModal(e)},deletePhoto:function(o){_preventDefault(o),photoModel.deletePhoto(galleryView._currentPhotoId),mobileNotify("Deleted current photo"),APP.kendo.navigate("#:back")},sharePhoto:function(o){_preventDefault(o)},editPhoto:function(o){_preventDefault(o)},selectSearchTool:function(o){_preventDefault(o);var e=this.current().index();switch(e){case 0:$("#gallerySearch").attr("placeholder","Search all");break;case 1:$("#gallerySearch").attr("placeholder","Search contacts");break;case 2:$("#gallerySearch").attr("placeholder","Search chats");break;case 3:$("#gallerySearch").attr("placeholder","Search dates");break;case 4:$("#gallerySearch").attr("placeholder","Search places")}}},photoView={_activePhoto:{},_activePhotoId:null,_activePhotoUrl:null,onInit:function(o){_preventDefault(o)},onShow:function(o){_preventDefault(o),void 0!==o.view.params.photo?photoView._activePhotoId=LZString.decompressFromEncodedURIComponent(o.view.params.photo):photoView._activePhotoId=galleryView._currentPhotoId,null!==photoView._activePhotoId&&(photoView._activePhoto=photoModel.findPhotoById(photoView._activePhotoId),photoView._activePhotoUrl=photoView._activePhoto.imageUrl)},onHide:function(o){},setImageUrl:function(o){$("#photoViewImage").attr("src",o)},deletePhoto:function(o){_preventDefault(o),modalView.open("Delete this photo","Click Delete to remove this photo or Keep to cancel delete ","Delete",function(){photoModel.deletePhoto(photoView._activePhotoId),mobileNotify("Deleted the current photo"),APP.kendo.navigate("#:back")},"Keep",function(){mobileNotify("Delete cancelled.")})},sharePhoto:function(o){_preventDefault(o),window.navigator.simulator===!0?mobileNotify("Export and Sharing only on device..."):_socialShare(null,null,photoView._activePhotoUrl,null)},editPhoto:function(o){_preventDefault(o);var e=LZString.compressToEncodedURIComponent(photoView._activePhotoId);APP.kendo.navigate("#photoEditor?source=gallery&photo="+e)}},photoEditor={_activePhoto:{},_activePhotoId:null,_activePhotoUrl:null,_rotationAngle:0,_source:null,onInit:function(o){_preventDefault(o)},onShow:function(o){_preventDefault(o),photoEditor._source=o.view.params.source,"profile"===photoEditor._source?photoEditor._activePhotoUrl=LZString.decompressFromEncodedURIComponent(o.view.params.url):(photoEditor._activePhotoId=LZString.decompressFromEncodedURIComponent(o.view.params.photo),photoEditor._activePhoto=photoModel.findPhotoById(photoEditor._activePhotoId),photoEditor._activePhotoUrl=photoEditor._activePhoto.imageUrl),photoEditor.setImageUrl(photoEditor._activePhoto.imageUrl),photoEditor._rotationAngle=0},setImageUrl:function(o){$("#photoEditImage").attr("src",o)},onHide:function(o){$("#photoEditImage").cropper("destroy")},crop:function(o){_preventDefault(o);var e=$("#photoEditImage"),t=e.cropper("getCroppedCanvas"),i=t.toDataURL("image/jpeg");e.cropper("replace",i),$("#photoEditImage").attr("src",i),$("#photoEditSaveDiv").removeClass("hidden")},rotateLeft:function(o){_preventDefault(o),photoEditor._rotationAngle-=90,$("#photoEditImage").cropper("rotate",photoEditor._rotationAngle)},rotateRight:function(o){_preventDefault(o),photoEditor._rotationAngle+=90,$("#photoEditImage").cropper("rotate",photoEditor._rotationAngle)},savePhoto:function(o){_preventDefault(o);var e=$("#photoEditImage").attr("src");mobileNotify("Photo updated"),APP.kendo.navigate("#:back")}},modalPhotoTag={_activePhoto:new kendo.data.ObservableObject,openModal:function(o){modalPhotoTag._activePhoto.set("photoId",o.photoId),modalPhotoTag._activePhoto.set("title",o.title),modalPhotoTag._activePhoto.set("imageUrl",o.imageUrl),modalPhotoTag._activePhoto.set("description",o.description),modalPhotoTag._activePhoto.set("tags",o.tags),modalPhotoTag._activePhoto.set("tagsString",o.tagsString),$("#modalview-photoTag").data("kendoMobileModalView").open()},closeModal:function(){$("#modalview-photoTag").data("kendoMobileModalView").close()},onCancel:function(o){modalPhotoTag.closeModal(),modalPhotoView.openModal(modalPhotoTag._activePhoto)},onDone:function(o){_preventDefault(o);var e=photoModel.findPhotoById(modalPhotoTag._activePhoto.photoId);void 0!==e?(e.title=modalPhotoTag._activePhoto.title,e.description=modalPhotoTag._activePhoto.description,e.tagsString=modalPhotoTag._activePhoto.tagsString,e.tagsString.length>0?e.tags=e.tagsString.split(","):e.tags=[],updateParseObject("photos","photoId",modalPhotoTag._activePhoto.photoId,"title",e.title),updateParseObject("photos","photoId",modalPhotoTag._activePhoto.photoId,"description",e.description),updateParseObject("photos","photoId",modalPhotoTag._activePhoto.photoId,"tags",e.tags),updateParseObject("photos","photoId",modalPhotoTag._activePhoto.photoId,"tagsString",e.tagsString)):mobileNotify("Can't find photo model!!"),modalPhotoTag.closeModal(),modalPhotoView.openModal(modalPhotoTag._activePhoto)}},modalPhotoView={_photo:null,_photoUrl:null,_dummyTitle:"Title",_dummyDescription:"",_dummyTagsString:"",_activePhoto:new kendo.data.ObservableObject,_showInfo:!1,onInit:function(o){var e=modalPhotoView._showInfo;$(".photoViewBox").kendoTouch({filter:"img",tap:function(o){e?($(".photoTitleBox").velocity({height:"6rem"},{duration:300}),e=!1):($(".photoTitleBox").velocity({height:"10rem"},{duration:300}),e=!0)}})},openModal:function(o){modalPhotoView._photo=o,modalPhotoView._photoUrl=o.imageUrl,modalPhotoView._activePhoto.set("photoId",o.photoId),null===o.title&&(o.title=modalPhotoView._dummyTitle),modalPhotoView._activePhoto.set("title",o.title),modalPhotoView._activePhoto.set("imageUrl",o.imageUrl),null===o.description&&(o.description=modalPhotoView._dummyDescription),modalPhotoView._activePhoto.set("description",o.description),modalPhotoView._activePhoto.set("tags",o.tags),(void 0===o.tagsString||null===o.tagsString)&&(o.tagsString=modalPhotoView._dummyTagsString),modalPhotoView._activePhoto.set("tagsString",o.tagsString),$("#modalPhotoView").data("kendoMobileModalView").open()},closeModal:function(){$("#modalPhotoView").data("kendoMobileModalView").close()},openTagEditor:function(o){_preventDefault(o),$(".photoTitleBox").velocity({height:"20rem"},{duration:800,easing:"spring"}),$(".photoTitleText").addClass("hidden"),$(".photoTitleInput").removeClass("hidden"),modalPhotoView._showInfo=!0,$("#modalPhotoView .actionBtn").velocity("fadeOut",{duration:0}),$("#modalPhotoView-close").addClass("hidden"),$("#modalPhotoView-update").removeClass("hidden")},closeTagEditor:function(o){var e=photoModel.findPhotoById(modalPhotoView._activePhoto.photoId);void 0!==e?(e.title=modalPhotoView._activePhoto.title,e.description=modalPhotoView._activePhoto.description,e.tagsString=modalPhotoView._activePhoto.tagsString,e.tagsString.length>0?e.tags=e.tagsString.split(","):e.tags=[],updateParseObject("photos","photoId",modalPhotoView._activePhoto.photoId,"title",e.title),updateParseObject("photos","photoId",modalPhotoView._activePhoto.photoId,"description",e.description),updateParseObject("photos","photoId",modalPhotoView._activePhoto.photoId,"tags",e.tags),updateParseObject("photos","photoId",modalPhotoView._activePhoto.photoId,"tagsString",e.tagsString)):mobileNotify("Can't find photo model!!"),$(".photoTitleBox").velocity({height:"6rem"},{duration:400}),$(".photoTitleText").removeClass("hidden"),$(".photoTitleInput").addClass("hidden"),$("#modalPhotoView .actionBtn").velocity("fadeIn",{delay:300}),$("#modalPhotoView-close").removeClass("hidden"),$("#modalPhotoView-update").addClass("hidden")},deletePhoto:function(o){_preventDefault(o)},sharePhoto:function(o){if(_preventDefault(o),window.navigator.simulator===!0)mobileNotify("Export and Sharing only on device...");else{var e=$("#modalPhotoViewImage").attr("src");_socialShare(null,null,e,null)}}},modalGalleryView={_callback:null,openModal:function(o){void 0!==o&&(modalGalleryView._callback=o),$("#modalgallery-listview li").css("width","100%"),$("#modalgallery-listview li").css("padding-bottom","100%"),$("#modalGalleryView").data("kendoMobileModalView").open()},closeModal:function(o){_preventDefault(o),$("#modalGalleryView").data("kendoMobileModalView").close()},galleryClick:function(o){_preventDefault(o);var e=o.dataItem.photoId,t=o.dataItem.imageUrl,i=o.dataItem.thumbnailUrl;currentChannelModel.currentMessage.photo={thumb:i,photo:t},null!==modalGalleryView._callback&&(modalGalleryView._callback(t),modalGalleryView.closeModal())}},galleryPicker={_photo:null,_photoId:null,_callback:null,onInit:function(o){_preventDefault(o),$("#galleryPickerSearch").on("input",function(){var o=this.value;o.length>0?photoModel.photosDS.filter({logic:"or",filters:[{field:"title",operator:"contains",value:o},{field:"description",operator:"contains",value:o},{field:"tagsString",operator:"contains",value:o},{field:"dateString",operator:"contains",value:o},{field:"addressString",operator:"contains",value:o}]}):photoModel.photosDS.filter([])})},onOpen:function(o){_preventDefault(o)},onClose:function(o){_preventDefault(o)},onGalleryClick:function(o){var e=o.dataItem;galleryPicker.photo=e,galleryPicker.closeModal(),null!==galleryPicker._callback&&galleryPicker._callback(e)},openModal:function(o){void 0!==o&&(galleryPicker._callback=o),$("#modalview-galleryPicker").kendoMobileModalView("open")},closeModal:function(){photoModel.photosDS.filter([]),$("#modalview-galleryPicker").kendoMobileModalView("close")},setListView:function(o){$("#galleryPicker-listview li").css("width","100%"),$("#galleryPicker-listview li").css("padding-bottom","100%")},setGridView:function(o){$("#galleryPicker-listview li").css("width","33%"),$("#galleryPicker-listview li").css("padding-bottom","33%")}};