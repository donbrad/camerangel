"use strict";var placesView={placeListDS:new kendo.data.DataSource({sort:{field:"distance",dir:"asc"}}),onInit:function(e){_preventDefault(e),placesModel.locatorActive=!1,$("#placeSearchQuery").clearSearch({callback:function(){placesView.placeListDS.data(placesModel.placesDS.data()),placesView.placeListDS.filter([])}}),$("#placeSearchQuery").keyup(function(){var e=this.value;e.length>0?placesView.placeListDS.filter({logic:"or",filters:[{field:"address",operator:"contains",value:e},{field:"name",operator:"contains",value:e},{field:"alias",operator:"contains",value:e}]}):(placesView.placeListDS.data(placesModel.placesDS.data()),placesView.placeListDS.filter([]))}),$("#places-listview").kendoMobileListView({dataSource:placesView.placeListDS,template:$("#placesTemplate").html(),dataBound:function(e){ux.checkEmptyUIState(findPlacesView.placesDS,"#placeListDiv >")}}).kendoTouch({filter:".list-box",enableSwipe:!0,tap:function(e){var a=e.touch.target[0].dataset.id},swipe:function(e){var a=e.sender.events.currentTarget;if("left"===e.direction){var t=$(".place-active");$(t).velocity({translateX:"0"},{duration:"fast"}).removeClass("place-active"),$(window).width()<375?$(a).velocity({translateX:"-50%"},{duration:"fast"}).addClass("place-active"):$(a).velocity({translateX:"-40%"},{duration:"fast"}).addClass("place-active")}"right"===e.direction&&$(a).hasClass("place-active")&&$(a).velocity({translateX:"0"},{duration:"fast"}).removeClass("place-active")}})},editPlaceBtn:function(e){var a=e.button[0].dataset.id,t="#editPlace?place="+LZString.compressToEncodedURIComponent(a)+"&returnview=places";APP.kendo.navigate(t)},deletePlaceBtn:function(e){},onShow:function(e){_preventDefault(e),ux.changeActionBtnImg("#places","icon-gps-light"),ux.showActionBtn(!1,"#places"),ux.scrollUpSearch(e),mapModel.getCurrentPosition(function(e,a){mapModel.computePlaceDistance(),placesView.placeListDS.data(placesModel.placesDS.data());var t=placesModel.matchLocation(e,a);if(0===t.length){mobileNotify("No places match your current location");var i="#findPlace?lat="+e+"&lng="+a+"&returnview=places";ux.showActionBtn(!0,"#places",i)}else{for(var c=0;c<t.length;c++){var l=!1;mapModel.currentPlaceId===t[c].uuid&&(l=!0,$("#current-place-name").text(currentPlace.name),$("#current-place").removeClass("hidden").velocity("slideDown"))}l||mobileNotify("Are you at a new Place?")}})},onHide:function(e){ux.showActionBtn(!1,"#places"),ux.hideActionBtnText("#places"),ux.changeActionBtnImg("#places","nav-add-white")}},findPlacesView={_returnView:"places",_returnModeal:null,_lat:null,_lng:null,_currentLocation:{},placesDS:new kendo.data.DataSource({sort:{field:"name",dir:"asc"},group:"category"}),onInit:function(e){_preventDefault(e),$("#findplace-listview").kendoMobileListView({dataSource:findPlacesView.placesDS,template:$("#findPlacesTemplate").html(),headerTemplate:$("#findPlacesHeaderTemplate").html(),fixedHeaders:!0,click:function(e){var a=e.dataItem,t=LZString.compressToEncodedURIComponent(JSON.stringify(a)),i="#addPlace?geo="+t+"&returnview=findPlace";APP.kendo.navigate(i)}})},onShow:function(e){_preventDefault(e);var a=findPlacesView.placesDS,t=findPlacesView._lat,i=findPlacesView._lng;void 0!==e.view.params&&(void 0!==e.view.params.lat&&(t=e.view.params.lat,i=e.view.params.lng,findPlacesView._lat=t,findPlacesView._lng=i),void 0!==e.view.params.returnview&&(findPlacesView._returnView=e.view.params.returnview),void 0!==e.view.params.returnmodal&&(findPlacesView._returnModal=e.view.params.returnmodal));var c=new google.maps.LatLng(t,i);a.data([]),mapModel.geocoder.geocode({latLng:c},function(e,c){if(c!==google.maps.GeocoderStatus.OK)return void mobileNotify("Google geocoding service error!");if(0===e.length||"street_address"!==e[0].types[0])return void mobileNotify("We couldn't match your position to a street address.");var l=findPlacesView.getAddressFromComponents(e[0].address_components),n={category:"Location",name:l.streetNumber+" "+l.street,type:"Street Address",googleId:null,icon:null,reference:null,streetNumber:l.streetNumber,street:l.street,address:l.streetNumber+" "+l.street,city:l.city,state:l.state,zipcode:l.zip,country:l.country,lat:t,lng:i,vicinity:l.city+", "+l.state};findPlacesView._currentLocation=n,a.add(n),findPlacesView.updatePlaces(t,i)})},onHide:function(e){},getTypesFromComponents:function(e){var a="";if(void 0===e||0===e.length)return"Establishment";for(var t=0;t<e.length;t++)if("point_of_interest"!==e[t]&&"establishment"!==e[t]&&"food"!==e[t]){var i=e[t].replace(/_/g," "),i=i.charAt(0).toUpperCase()+i.substring(1);a+=i+", "}return a=a.length>3?a.substring(0,a.length-2):"Establishment"},truncatePlaceName:function(e){},getAddressFromComponents:function(e){var a={};return a.streetNumber=_.findWhere(e,{types:["street_number"]}),a.streetNumber=void 0===a.streetNumber?"":a.streetNumber.short_name,a.street=_.findWhere(e,{types:["route"]}),a.street=void 0===a.street?"":a.street.short_name,a.city=_.findWhere(e,{types:["locality","political"]}),a.city=void 0===a.city?"":a.city.short_name,a.state=_.findWhere(e,{types:["administrative_area_level_1","political"]}),a.state=void 0===a.state?"":a.state.short_name,a.zip=_.findWhere(e,{types:["postal_code"]}),a.zip=void 0===a.zip?"":a.zip.short_name,a.country=_.findWhere(e,{types:["country","political"]}),a.country=void 0===a.country?"":a.country.short_name,a},updatePlaces:function(e,a){var t=new google.maps.LatLng(e,a),i=mapModel.googlePlaces,c=findPlacesView.placesDS;i.nearbySearch({location:t,radius:homeView._radius,types:["establishment"]},function(e,a){a===google.maps.places.PlacesServiceStatus.OK&&e.forEach(function(e){var a=findPlacesView._currentLocation;c.add({category:"Place",name:e.name.smartTruncate(24,!0),type:findPlacesView.getTypesFromComponents(e.types),googleId:e.place_id,icon:e.icon,address:a.address,city:a.city,state:a.state,zipcode:a.zipcode,country:a.country,reference:e.reference,lat:e.geometry.location.H,lng:e.geometry.location.L,vicinity:e.vicinity})})})},onDone:function(e){_preventDefault(e);var a="#"+findPlacesView._returnView;APP.kendo.navigate(a)}},addPlaceView={_activeGeo:{},_activePlace:new kendo.data.ObservableObject,_returnView:"places",onInit:function(e){_preventDefault(e),$("#addplace-typeBtns").data("kendoMobileButtonGroup")},onShow:function(e){if(_preventDefault(e),$("#addPlaceCreateChat").attr("checked",!1),void 0!==e.view.params){if(void 0!==e.view.params.geo){var a=LZString.decompressFromEncodedURIComponent(e.view.params.geo),t=JSON.parse(a);addPlaceView.setActivePlace(t)}void 0!==e.view.params.returnview&&(addPlaceView._returnView=e.view.params.returnview),void 0!==e.view.params.returnmodal&&(addPlaceView._returnModal=e.view.params.returnmodal)}},onHide:function(e){},onDone:function(e){_preventDefault(e);var a="#"+addPlaceView._returnView;APP.kendo.navigate(a)},placeTypeSelect:function(e){var a=this.current().index();0===a?($("#addPlace-privateHelper").removeClass("hidden"),$("#addPlace-publicHelper").addClass("hidden"),$("#placeTypePrivateImg").attr("src","images/place-private-active.svg"),$("#placeTypePublicImg").attr("src","images/place-public.svg"),$("#placeAutoCheckin").velocity("fadeOut")):($("#addPlace-publicHelper").removeClass("hidden"),$("#addPlace-privateHelper").addClass("hidden"),$("#placeTypePrivateImg").attr("src","images/place-private.svg"),$("#placeTypePublicImg").attr("src","images/place-public-active.svg"),$("#placeAutoCheckin").velocity("fadeIn"))},setActivePlace:function(e){addPlaceView._activeGeo=e,addPlaceView._activePlace.set("name",e.name),addPlaceView._activePlace.set("alias",e.alias),addPlaceView._activePlace.set("venueName",e.venueName),addPlaceView._activePlace.set("isAvailable","true"),addPlaceView._activePlace.set("isPrivate","true"),addPlaceView._activePlace.set("address",e.address),addPlaceView._activePlace.set("city",e.city),addPlaceView._activePlace.set("state",e.state),addPlaceView._activePlace.set("country",e.country),addPlaceView._activePlace.set("zipcode",e.zipcode),addPlaceView._activePlace.set("type",e.type),addPlaceView._activePlace.set("lat",e.lat),addPlaceView._activePlace.set("lng",e.lng),"Location"===e.category?(addPlaceView._activePlace.set("category","Location"),addPlaceView._activePlace.set("googleId",""),addPlaceView._activePlace.set("icon",""),addPlaceView._activePlace.set("reference","")):(addPlaceView._activePlace.set("category","Venue"),addPlaceView._activePlace.set("icon",e.icon),addPlaceView._activePlace.set("reference",e.reference),addPlaceView._activePlace.set("googleId",e.googleId))},addPlace:function(e){_preventDefault(e);var a=$("#addPlace-form").kendoValidator().data("kendoValidator");if(a.validate()){var t=placesModel.newPlace(),i=addPlaceView._activePlace,c=uuid.v4(),l=$("#addPlaceCreateChat").is("checked");t.set("uuid",c),t.set("category",i.category),t.set("name",i.name),t.set("venueName",i.venueName),t.set("alias",i.alias),t.set("googleId",i.googleId),t.set("address",i.address),t.set("lat",i.lat),t.set("lng",i.lng),t.set("type",i.type),t.set("city",i.city),t.set("state",i.state),t.set("country",i.country),t.set("zipcode",i.zipcode),t.set("isAvailable","true"===i.isAvailable),t.set("isPrivate","true"===i.isPrivate),t.set("hasPlaceChat","true"===i.hasPlaceChat),placesModel.placesDS.add(t),placesModel.placesDS.sync(),mobileNotify(i.name+" added to your Places..."),addPlaceView.onDone()}}},editPlaceView={_activePlaceId:null,_activePlaceModel:null,_activePlace:new kendo.data.ObservableObject,_returnView:"places",_returnModal:void 0,onInit:function(e){_preventDefault(e)},onShow:function(e){if(_preventDefault(e),void 0!==e.view.params){if(void 0!==e.view.params.place){var a=LZString.decompressFromEncodedURIComponent(e.view.params.place);editPlaceView.setActivePlace(a)}void 0!==e.view.params.returnview&&(editPlaceView._returnView=e.view.params.returnview),void 0!==e.view.params.returnmodal&&(editPlaceView._returnModal=e.view.params.returnmodal)}var t=editPlaceView._activePlace;t.isPrivate?($("#publicPlaceHelper").addClass("hidden"),$("#privatePlaceHelper").removeClass("hidden")):($("#publicPlaceHelper").removeClass("hidden"),$("#privatePlaceHelper").addClass("hidden"))},update:function(){var e=$("#placeEdit-name").val(),a=$("#placeEdit-alias").val(),t=$("#placeEdit-address").val(),i=$("#placeEdit-form").kendoValidator().data("kendoValidator");i.validate()&&editPlaceView.onDone()},onHide:function(e){},onDone:function(e){_preventDefault(e);var a=editPlaceView._activePlaceModel,t=editPlaceView._activePlace;a.set("name",t.name),a.set("alias",t.alias),a.set("address",t.address),a.set("isPrivate",t.isPrivate),a.set("isAvailable",t.isAvailable),mobileNotify("Updated "+t.name),placesModel.placesDS.sync();var i="#"+editPlaceView._returnView;APP.kendo.navigate(i)},setActivePlace:function(e){editPlaceView._activePlaceId=e;var a=placesModel.getPlaceModel(e);editPlaceView._activePlaceModel=a,editPlaceView._activePlace.set("name",a.name),editPlaceView._activePlace.set("alias",a.alias),editPlaceView._activePlace.set("address",a.address),editPlaceView._activePlace.set("city",a.city),editPlaceView._activePlace.set("state",a.state),editPlaceView._activePlace.set("zipcode",a.zipcode),editPlaceView._activePlace.set("isPrivate",a.isPrivate),editPlaceView._activePlace.set("isAvailable",a.isAvailable)}},placeView={_activePlace:null,_activePlaceId:null,_lat:null,_lng:null,_returnView:"places",onInit:function(e){_preventDefault(e)},onShow:function(e){if(_preventDefault(e),void 0!==e.view.params){if(void 0!==e.view.params.place){var a=LZString.decompressFromEncodedURIComponent(e.view.params.place);editPlaceView.setActivePlace(a)}else placeView._activePlace=null,placeView._activePlaceId=null;void 0!==e.view.params.lat&&(placeView._lat=e.view.params.lat,placeView._lng=e.view.params.lng),void 0!==e.view.params.returnview&&(editPlaceView._returnView=e.view.params.returnview)}},onHide:function(e){},onDone:function(e){_preventDefault(e);var a="#"+placeView._returnView;APP.kendo.navigate(a)},setActivePlace:function(e){placeView._activePlaceId=e,placeView._activePlace=placesModel.getPlaceModel(e)}},checkInView={_returnView:"places",_returnModal:null,_callback:null,placesDS:new kendo.data.DataSource({sort:{field:"distance",dir:"asc"},group:"category"}),onInit:function(e){_preventDefault(e),$("#checkin-listview").kendoMobileListView({dataSource:checkInView.placesDS,template:$("#checkinPlacesTemplate").html(),click:function(e){var a=e.dataItem,t=a.uuid;mapModel.checkIn(t),userModel.checkIn(t),userStatus.update(),mobileNotify("You're checked in to "+a.name)}})},locateAndOpenModal:function(e){_preventDefault(e),checkInView._returnView=APP.kendo.view().id,mapModel.matchPlaces(function(e){mapModel.computePlaceArrayDistance(e),checkInView.openModal(e,checkInView.onDone)})},openModal:function(e,a){void 0!==a&&null!==a&&(checkInView.callback=a),e.length>0&&checkInView.placesDS.data(e),$("#modalview-checkin").data("kendoMobileModalView").open()},closeModal:function(){$("#modalview-checkin").data("kendoMobileModalView").close(),null!==checkInView.callback&&checkInView.callback()},onDone:function(e){_preventDefault(e);var a="#"+checkInView._returnView;APP.kendo.navigate(a)}};