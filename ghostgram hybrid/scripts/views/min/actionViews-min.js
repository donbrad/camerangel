"use strict";var modalActionMeeting={_activeObject:new kendo.data.ObservableObject,_date:new Date,_placeId:null,_isInited:!1,_eventList:[],response:!1,onInit:function(e){_preventDefault(e)},initActiveObject:function(){var e=modalActionMeeting._activeObject,t=Date.today();e.set("uuid",uuid.v4()),e.set("senderUUID",null),e.set("channelId",null),e.set("eventChatId",null),e.set("title",null),e.set("type","meeting"),e.set("action",null),e.set("description",null),e.set("address",null),e.set("placeName",null),e.set("placeId",null),e.set("calendarId",null),e.set("lat",null),e.set("lng",null),e.set("date",t),e.set("approxTime",!1),e.set("approxPlace",!1),e.set("timeFlexible",!1),e.set("placeFlexible",!1),e.set("isDeleted",!1),e.set("isModified",!1),e.set("isAccepted",!1),e.set("isAccepted",!1),e.set("addToCalendar",!1),e.set("declineList",[]),e.set("acceptList",[]),e.set("inviteList",[]),e.set("comment",null),e.set("commentList",[]),e.set("wasSent",!1),$("#modalActionMeeting-placesearch").val(e.placeName),$("#modalActionMeeting-datestring").val(new Date(e.date).toString("dddd, MMMM dd, yyyy h:mm tt")),$("#modalActionMeeting-date").val(new Date(e.date).toString("MMMM dd, yyyy")),$("#modalActionMeeting-time").val(new Date(e.date).toString("h:mm tt"))},setActiveObject:function(e){var t=modalActionMeeting._activeObject;(void 0===e.uuid||null===e.uuid)&&(e.uuid=uuid.v4()),t.set("wasSent",!0),t.set("channelId",e.channelId),t.set("eventChatId",e.eventChatId),t.set("title",e.title),t.set("type",e.type),t.set("uuid",e.uuid),t.set("senderUUID",e.senderUUID),t.set("action",e.action),t.set("description",e.description),t.set("address",e.address),t.set("placeName",e.placeName),t.set("calendarId",e.calendarId),t.set("placeId",e.placeId),t.set("lat",e.lat),t.set("lng",e.lng),(void 0===e.date||null===e.date)&&(e.date=new Date),t.set("date",e.date),t.set("acceptList",e.acceptList),t.set("declineList",e.declineList),t.set("inviteList",e.inviteList),t.set("commentList",e.commentList),t.set("approxTime",e.approxTime),t.set("approxPlace",e.approxPlace),t.set("timeFlexible",e.timeFlexible),t.set("placeFlexible",e.placeFlexible),t.set("isModified",e.isModified),t.set("isDeleted",e.isDeleted),t.set("isAccepted",e.isAccepted),t.set("isDeclined",e.isDeclined),t.set("addToCalendar",!1),void 0!==e.calendarId||null!==e.calendarID?(t.set("addToCalendar",!0),$("#actionMeeting-addToCalendar").prop("readonly",!0)):$("#actionMeeting-addToCalendar").prop("readonly",!1),null===e.senderUUID||e.senderUUID===userModel.currentUser.userUUID?modalActionMeeting.setSenderMode():modalActionMeeting.setRecipientMode()},setSenderMode:function(){var e=modalActionMeeting._activeObject;$(".event-owner, #event-viewMode").removeClass("hidden"),$(".event-recipient, #event-editMode").addClass("hidden"),$("#event-owner-edit").addClass("hidden"),e.wasSent?e.isExpired?($("#actionMeeting-reschedule").removeClass("hidden"),$("#actionMeeting-update").addClass("hidden"),$("#event-owner-cancel").addClass("hidden")):($("#actionMeeting-reschedule").addClass("hidden"),$("#event-owner-cancel").removeClass("hidden"),$("#event-owner-edit").removeClass("hidden")):modalActionMeeting.showEditMode()},showEditMode:function(){$("#event-owner-edit").addClass("hidden"),$("#event-editMode").removeClass("hidden"),$("#event-viewMode").addClass("hidden"),$("#actionMeeting-save").removeClass("hidden"),$("#actionMeeting-reschedule").addClass("hidden");var e=modalActionMeeting._activeObject;$("#modalActionMeeting-placesearch").val(""),$("#modalActionMeeting-datestring").val(new Date(e.date).toString("MMMM dd, yyyy h:mm tt")),$("#modalActionMeeting-date").val(new Date(e.date).toString("MMMM dd, yyyy")),$("#modalActionMeeting-time").val(new Date(e.date).toString("h:mm tt"))},setAcceptStatus:function(){var e=modalActionMeeting._activeObject;e.isAccepted?$("#actionMeeting-acceptStatus").text("You've accepted this event"):e.isDeclined?$("#actionMeeting-acceptStatus").text("You've declined this event"):$("#actionMeeting-acceptStatus").text("Please accept or decline this event")},setRecipientMode:function(){var e=modalActionMeeting._activeObject;$(".event-owner").addClass("hidden"),$(".event-recipient, #event-viewMode").removeClass("hidden"),e.isExpired?$("#event-rsvp").data("kendoMobileButtonGroup").enable(!1):($("#event-rsvp").data("kendoMobileButtonGroup").enable(!0),e.isAccepted?($("#event-rsvp").data("kendoMobileButtonGroup").select(0),modalActionMeeting.setEventBanner("accepted")):e.isDeclined?($("#event-rsvp").data("kendoMobileButtonGroup").select(1),modalActionMeeting.setEventBanner("declined")):modalActionMeeting.setEventBanner("pending"))},onShow:function(e){_preventDefault(e),modalActionMeeting._placeId=null,$("#modalActionMeeting-placesearchBtn").text(""),$("#modalActionMeeting-placesearch").val(""),$("#modalActionMeeting-datestring").val(""),$("#modalActionMeeting-date").val(""),$("#modalActionMeeting-time").val(""),$("#modalActionMeeting-comments").val("")},placeSearch:function(e){_preventDefault(e);var t=$("#modalActionMeeting-placesearch").val();mobileNotify("SearchPlaces : "+t)},updateDateString:function(){var e=$("#modalActionMeeting-date").val(),t=$("#modalActionMeeting-time").val(),n=e+" "+t;$("#modalActionMeeting-datestring").val(n),modalActionMeeting._activeObject.set("date",new Date(n))},openModal:function(e){if(modalActionMeeting._isInited||(modalActionMeeting._eventList=smartObject.getActionNames(),$("#modalActionMeeting-title").kendoAutoComplete({dataSource:modalActionMeeting._eventList,ignoreCase:!0,change:function(e){var t=$("#modalActionMeeting-title").val();modalActionMeeting._activeObject.set("title",t)},select:function(e){var t=e.item,n=e.item[0].textContent;modalActionMeeting._activeObject.set("action",n)},filter:"contains",placeholder:"Event title"}),$("#modalActionMeeting-datestring").on("blur",function(){var e=$("#modalActionMeeting-datestring").val();if(e.length>6){var t=e.match(/\d{1,2}([:.]?\d{1,2})?([ ]?[a|p]m)/gi),n=Date.today(),a="";if(null!==t&&t.length>0){e=e.replace(t[0],""),e=e.trim();var i=Date.parse(t[0]);a=new Date(i).toString("h:mm tt")}e.length>4&&(n=Date.parse(e));var d=new Date(n).toString("MMMM dd, yyyy"),s=d;""!==a&&(s+=" "+a),$("#modalActionMeeting-date").val(d),$("#modalActionMeeting-time").val(a),modalActionMeeting._activeObject.set("date",new Date(s))}}),$("#modalActionMeeting-date").pickadate({weekdaysShort:["Su","Mo","Tu","We","Th","Fr","Sa"],showMonthsShort:!0,onClose:function(){modalActionMeeting.updateDateString()}}),$("#modalActionMeeting-time").on("blur",function(){var e=$("#modalActionMeeting-time").val(),t=Date.parse(e),n=new Date(t).toString("h:mm tt");$("#modalActionMeeting-time").val(n),modalActionMeeting.updateDateString()}),$("#modalActionMeeting-placesearch").on("input",function(){var e=$("#modalActionMeeting-placesearch").val();e.length>3?($("#modalActionMeeting-placesearchBtn").text("Find "+e),$("#modalActionMeeting-placesearchdiv").removeClass("hidden")):$("#modalActionMeeting-placesearchdiv").addClass("hidden")}),$("#modalActionMeeting-placesearch").kendoAutoComplete({dataSource:placesModel.placesDS,ignoreCase:!0,dataTextField:"name",dataValueField:"uuid",change:function(e){var t=$("#modalActionMeeting-placesearch").val();if(null!==modalActionMeeting._placeId){var n=placesModel.getPlaceModel(modalActionMeeting._placeId);if(t===n.name)return;modalActionMeeting._placeId=null,modalActionMeeting._activeObject.set("placeId",modalActionMeeting._placeId),modalActionMeeting._activeObject.set("placeName",t),modalActionMeeting._activeObject.set("address",t)}t.length>3?($("#modalActionMeeting-placesearchBtn").text("Find "+t),$("#modalActionMeeting-placesearchdiv").removeClass("hidden")):$("#modalActionMeeting-placesearchdiv").addClass("hidden")},select:function(e){var t=e.item,n=this.dataItem(e.item.index());modalActionMeeting._placeId=n.uuid,modalActionMeeting._activeObject.set("placeId",modalActionMeeting._placeId),modalActionMeeting._activeObject.set("placeName",n.name),modalActionMeeting._activeObject.set("address",n.address),$("#modalActionMeeting-placesearchdiv").addClass("hidden")},filter:"contains",placeholder:"Select location... "}),modalActionMeeting._isInited=!0),modalActionMeeting._date=new Date,void 0===e||null===e)modalActionMeeting.initActiveObject(),modalActionMeeting.setSenderMode();else{modalActionMeeting.setActiveObject(e);var t=modalActionMeeting._activeObject;moment(modalActionMeeting._date).isAfter(t.date)?(modalActionMeeting.setEventBanner("expired"),t.set("isExpired",!0)):t.set("isExpired",!1),void 0===t.senderUUID||null===t.senderUUID?modalActionMeeting.setSenderMode():t.senderUUID===userModel.currentUser.userUUID?modalActionMeeting.setSenderMode():modalActionMeeting.setRecipientMode(),null!==t.placeName?$(".event-location").removeClass("hidden"):$(".event-location").addClass("hidden");var n=moment(t.date).format("ddd MMM Do [at] hA");$(".event-date").text(n)}$("#modalActionMeeting-placesearchdiv").addClass("hidden"),$("#modalview-actionMeeting").data("kendoMobileModalView").open()},setEventBanner:function(e){switch(e){case"expired":$(".eventBanner").removeClass("hidden").addClass("eventExpired"),$(".eventBannerTitle").text("Event expired"),$(".eventBannerImg").attr("src","images/smart-time-light.svg");break;case"pending":$(".eventBanner").removeClass("hidden").addClass("eventPending");break;case"accepted":$(".eventBanner").removeClass("hidden").addClass("eventAccepted");break;case"declined":$(".eventBanner").removeClass("hidden").addClass("eventDeclined");break;default:$(".eventBanner").addClass("hidden"),$(".eventBannerTitle").text(""),$(".eventBannerImg").attr("src","")}},eventMapLocation:function(e){_preventDefault(e)},onCancel:function(e){_preventDefault(e),$(".event-owner, .event-recipient, #event-editMode, #event-viewMode").addClass("hidden"),$("#modalview-actionMeeting").data("kendoMobileModalView").close(),modalActionMeeting.setEventBanner()},sendEventStatus:function(e){modalActionMeeting.onDone()},onAccept:function(e){var t=modalActionMeeting._activeObject,n=$("#modalActionMeeting-comments").val();smartObject.accept(t.uuid,t.senderUUID,n),modalActionMeeting.setAcceptStatus(),modalActionMeeting.onDone()},onDecline:function(e){var t=modalActionMeeting._activeObject,n=$("#modalActionMeeting-comments").val();smartObject.accept(t.uuid,t.senderUUID,n),modalActionMeeting.setAcceptStatus(),modalActionMeeting.onDone()},doEventChat:function(e){_preventDefault(e),mobileNotify("Create Event Chat in progress...")},createSmartEvent:function(e){var t={};if(null===e.action){var n=e.title.split(" ");e.action=n[0].toLowerCase(),!smartObject.isCurrentAction(e.action)}t.uuid=e.uuid,t.action=e.action,t.type=e.type,t.title=e.title,t.description=e.description,t.date=e.date,t.placeId=e.placeId,t.placeName=e.placeName,t.address=e.address,t.senderUUID=userModel.currentUser.userUUID,t.channelId=e.channelId,t.eventChatId=e.eventChatId,t.calendarId=e.calendarId,t.lat=e.lat,t.lng=e.lng,t.approxTime=e.approxTime,t.approxPlace=e.approxPlace,t.timeFlexible=e.timeFlexible,t.placeFlexible=e.placeFlexible,t.isDeleted=!1,t.isModified=!0,t.isAccepted=e.isAccepted,t.isDeclined=e.isDeclined,t.declineList=e.declineList,t.acceptList=e.acceptList,t.inviteList=e.inviteList,t.commentList=e.commentList,channelView.addSmartObjectToMessage(e.uuid,t)},onUpdateEvent:function(e){var t=modalActionMeeting._activeObject;modalActionMeeting.onDone()},onSaveEvent:function(e){var t=modalActionMeeting._activeObject;modalActionMeeting.onDone()},onCancelEvent:function(e){var t=modalActionMeeting._activeObject;modalActionMeeting.onDone()},onDone:function(e){$("#modalview-actionMeeting").data("kendoMobileModalView").close()}},smartEventView={_activeObject:new kendo.data.ObservableObject,_date:new Date,_placeId:null,_isInited:!1,_eventList:[],onInit:function(e){_preventDefault(e)},initActiveObject:function(){var e=smartEventView._activeObject,t=Date.today();e.set("uuid",uuid.v4()),e.set("senderUUID",userModel.currentUser.userUUID),e.set("channelId",null),e.set("eventChatId",null),e.set("title",null),e.set("type","meeting"),e.set("action",null),e.set("description",null),e.set("address",null),e.set("placeName",null),e.set("placeId",null),e.set("calendarId",null),e.set("lat",null),e.set("lng",null),e.set("date",t),e.set("approxTime",!1),e.set("approxPlace",!1),e.set("timeFlexible",!1),e.set("placeFlexible",!1),e.set("isDeleted",!1),e.set("isModified",!1),e.set("isAccepted",!1),e.set("isAccepted",!1),e.set("addToCalendar",!1),e.set("declineList",[]),e.set("acceptList",[]),e.set("inviteList",[]),e.set("comment",null),e.set("commentList",[]),e.set("wasSent",!1),$("#smartEventView-placesearch").val(e.placeName),$("#smartEventView-datestring").val(new Date(e.date).toString("dddd, MMMM dd, yyyy h:mm tt")),$("#smartEventView-date").val(new Date(e.date).toString("MMMM dd, yyyy")),$("#smartEventView-time").val(new Date(e.date).toString("h:mm tt"))},setActiveObject:function(e){var t=smartEventView._activeObject;(void 0===e.uuid||null===e.uuid)&&(e.uuid=uuid.v4()),t.set("wasSent",!0),t.set("channelId",e.channelId),t.set("eventChatId",e.eventChatId),t.set("title",e.title),t.set("type",e.type),t.set("uuid",e.uuid),t.set("senderUUID",e.senderUUID),t.set("action",e.action),t.set("description",e.description),t.set("address",e.address),t.set("placeName",e.placeName),t.set("calendarId",e.calendarId),t.set("placeId",e.placeId),t.set("lat",e.lat),t.set("lng",e.lng),(void 0===e.date||null===e.date)&&(e.date=new Date),t.set("date",e.date),t.set("acceptList",e.acceptList),t.set("declineList",e.declineList),t.set("inviteList",e.inviteList),t.set("commentList",e.commentList),t.set("approxTime",e.approxTime),t.set("approxPlace",e.approxPlace),t.set("timeFlexible",e.timeFlexible),t.set("placeFlexible",e.placeFlexible),t.set("isModified",e.isModified),t.set("isDeleted",e.isDeleted),t.set("isAccepted",e.isAccepted),t.set("isDeclined",e.isDeclined),t.set("addToCalendar",!1),void 0!==e.calendarId||null!==e.calendarID?(t.set("addToCalendar",!0),$("#smartEventView-addToCalendar").prop("readonly",!0)):$("#smartEventView-addToCalendar").prop("readonly",!1),void 0===e.senderUUID||e.senderUUID===userModel.currentUser.userUUID?smartEventView.setSenderMode():smartEventView.setRecipientMode(),$("#smartEventView-placesearch").val(e.placeName),$("#smartEventView-datestring").val(new Date(e.date).toString("dddd, MMMM dd, yyyy h:mm tt")),$("#smartEventView-date").val(new Date(e.date).toString("MMMM dd, yyyy")),$("#smartEventView-time").val(new Date(e.date).toString("h:mm tt"))},setSenderMode:function(e){e?($("#smartEventView-update").removeClass("hidden"),$("#smartEventView-save").addClass("hidden")):($("#smartEventView-save").removeClass("hidden"),$("#smartEventView-update").addClass("hidden")),$("#smartEventView-accept").addClass("hidden"),$("#smartEventView-commentsLi").addClass("hidden"),$("#smartEventView-title").prop("readonly",!1),$("#smartEventView-desc").prop("readonly",!1),$("#smartEventView-datestring").prop("readonly",!1),$("#smartEventView-date").prop("readonly",!1),$("#smartEventView-time").prop("readonly",!1)},setRecipientMode:function(){$("#smartEventView-save").addClass("hidden"),$("#smartEventView-accept").removeClass("hidden"),$("#smartEventView-commentsLi").removeClass("hidden"),$("#smartEventView-title").prop("readonly",!0),$("#smartEventView-desc").prop("readonly",!0),$("#smartEventView-datestring").prop("readonly",!0),$("#smartEventView-date").prop("readonly",!0),$("#smartEventView-time").prop("readonly",!0)},placeSearch:function(e){_preventDefault(e);var t=$("#smartEventView-placesearch").val();mobileNotify("SearchPlaces : "+t)},updateDateString:function(){var e=$("#smartEventView-date").val(),t=$("#smartEventView-time").val(),n=e+" "+t;$("#smartEventView-datestring").val(n),smartEventView._activeObject.set("date",new Date(n))},onShow:function(e){_preventDefault(e),modalActionMeeting._placeId=null,$("#smartEventView-placesearchBtn").text(""),$("#smartEventView-placesearch").val(""),$("#smartEventView-datestring").val(""),$("#smartEventView-comments").val(""),smartEventView._isInited||(smartEventView._eventList=smartObject.getActionNames(),$("#smartEventView-title").kendoAutoComplete({dataSource:smartEventView._eventList,ignoreCase:!0,change:function(e){var t=$("#modalActionMeeting-title").val();smartEventView._activeObject.set("title",t)},select:function(e){var t=e.item,n=e.item[0].textContent;smartEventView._activeObject.set("action",n)},filter:"contains",placeholder:"Select Event... "}),$("#smartEventView-datestring").on("blur",function(){var e=$("#smartEventView-datestring").val();if(e.length>6){var t=e.match(/\d{1,2}([:.]?\d{1,2})?([ ]?[a|p]m)/gi),n=Date.today(),a="";if(null!==t&&t.length>0){e=e.replace(t[0],""),e=e.trim();var i=Date.parse(t[0]);a=new Date(i).toString("h:mm tt")}e.length>4&&(n=Date.parse(e));var d=new Date(n).toString("MMMM dd, yyyy"),s=d;""!==a&&(s+=" "+a),$("#smartEventView-date").val(d),$("#smartEventView-time").val(a),smartEventView._activeObject.set("date",new Date(s))}}),$("#smartEventView-date").pickadate(),$("#smartEventView-date").on("blur",function(){smartEventView.updateDateString()}),$("#smartEventView-time").on("blur",function(){var e=$("#smartEventView-time").val(),t=Date.parse(e),n=new Date(t).toString("h:mm tt");$("#smartEventView-time").val(n),smartEventView.updateDateString()}),$("#smartEventView-placesearch").on("input",function(){var e=$("#smartEventView-placesearch").val();e.length>3?($("#smartEventView-placesearchBtn").text("Find "+e),$("#smartEventView-placesearchdiv").removeClass("hidden")):$("#smartEventView-placesearchdiv").addClass("hidden")}),$("#smartEventView-placesearch").kendoAutoComplete({dataSource:placesModel.placesDS,ignoreCase:!0,dataTextField:"name",dataValueField:"uuid",change:function(e){var t=$("#smartEventView-placesearch").val();if(null!==smartEventView._placeId){var n=placesModel.getPlaceModel(smartEventView._placeId);if(t===n.name)return;smartEventView._placeId=null,smartEventView._activeObject.set("placeId",smartEventView._placeId),smartEventView._activeObject.set("placeName",t),smartEventView._activeObject.set("address",t)}t.length>3?($("#smartEventView-placesearchBtn").text("Find "+t),$("#smartEventView-placesearchdiv").removeClass("hidden")):$("#smartEventView-placesearchdiv").addClass("hidden")},select:function(e){var t=e.item,n=this.dataItem(e.item.index());smartEventView._placeId=n.uuid,smartEventView._activeObject.set("placeId",modalActionMeeting._placeId),smartEventView._activeObject.set("placeName",n.name),smartEventView._activeObject.set("address",n.address),$("#smartEventView-placesearchdiv").addClass("hidden")},filter:"contains",placeholder:"Select location... "}),smartEventView._isInited=!0),smartEventView._date=new Date,void 0===actionObj||null===actionObj?smartEventView.initActiveObject():smartEventView.setActiveObject(actionObj),$("#smartEventView-placesearchdiv").addClass("hidden");var t=smartEventView._activeObject;void 0===t.senderUUID||null===t.senderUUID?smartEventView.setSenderMode():t.senderUUID===userModel.currentUser.userUUID?smartEventView.setSenderMode():smartEventView.setRecipientMode()},changeStatus:function(e){var t=this.current().index();modalActionMeeting.response!==!0&&($("#event-comment").velocity("slideDown"),modalActionMeeting.response=!0),0===t?$("#event-comment textarea").attr("placeholder","Looking forward to it!"):$("#event-comment textarea").attr("placeholder","Sorry can't make it.")},onCancel:function(e){},onAccept:function(e){},onDecline:function(e){},doEventChat:function(e){_preventDefault(e),mobileNotify("Create Event Chat in progress...")},createSmartEvent:function(e){var t={};if(null===e.action){var n=e.title.split(" ");e.action=n[0].toLowerCase(),!smartObject.isCurrentAction(e.action)}t.uuid=e.uuid,t.action=e.action,t.type=e.type,t.title=e.title,t.description=e.description,t.date=e.date,t.placeId=e.placeId,t.placeName=e.placeName,t.address=e.address,t.senderUUID=e.senderUUID,t.channelId=e.channelId,t.eventChatId=e.eventChatId,t.calendarId=e.calendarId,t.lat=e.lat,t.lng=e.lng,t.approxTime=e.approxTime,t.approxPlace=e.approxPlace,t.timeFlexible=e.timeFlexible,t.placeFlexible=e.placeFlexible,t.isDeleted=!1,t.isModified=!0,t.isAccepted=e.isAccepted,t.isDeclined=e.isDeclined,t.declineList=e.declineList,t.acceptList=e.acceptList,t.inviteList=e.inviteList,t.commentList=e.commentList,channelView.addSmartObjectToMessage(e.uuid,t)},onUpdateEvent:function(e){var t=modalActionMeeting._activeObject;modalActionMeeting.onDone()},onSaveEvent:function(e){var t=smartEventView._activeObject;if(t.senderUUID===userModel.currentUser.userUUID){var n=$("#smartEventView-datestring").val();smartEventView._activeObject.set("date",new Date(n)),smartEventView.createSmartEvent(t)}smartEventView.onDone()},onCancelEvent:function(e){var t=smartEventView._activeObject;smartEventView.onDone()},onDone:function(e){APP.kendo.navigate("#:back")}};